<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Canvas & Color Art Academy</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/styles/admin_dashboard.css">
</head>

<body>
  <!-- Loading Overlay -->
  <div id="loadingOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; justify-content: center; align-items: center; z-index: 9999;">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Verifying authentication...</p>
    </div>
  </div>
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Overlay for mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3 col-lg-2 sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="d-flex align-items-center">
            <i class="fas fa-palette me-2"></i>
            <span class="brand-text">Art Academy</span>
          </div>
        </div>
        <nav class="nav flex-column">
          <a class="nav-link active" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Dashboard">
            <i class="fas fa-tachometer-alt"></i>
            <span class="nav-text">Dashboard</span>
          </a>
          <a class="nav-link" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Students">
            <i class="fas fa-users"></i>
            <span class="nav-text">Students</span>
          </a>
          <a class="nav-link" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Courses">
            <i class="fas fa-book"></i>
            <span class="nav-text">Courses</span>
          </a>
          <a class="nav-link" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Reports">
            <i class="fas fa-chart-bar"></i>
            <span class="nav-text">Reports</span>
          </a>
          <a class="nav-link" href="#" id="logoutBtn" data-bs-toggle="tooltip" data-bs-placement="right" title="Logout">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-text">Logout</span>
          </a>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="col-md-9 col-lg-10 main-content" id="mainContent">
        <div class="content-wrapper">
          <div class="dashboard-header">
            <h2>Admin Dashboard</h2>
            <div class="user-info">
              <span id="welcomeMessage" class="text-muted"></span>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="row stats-row">
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                  <h5>Total Students</h5>
                  <h3 id="totalStudents">0</h3>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-book-open"></i>
                </div>
                <div class="stat-content">
                  <h5>Active Courses</h5>
                  <h3 id="activeCourses">0</h3>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-rupee-sign"></i>
                </div>
                <div class="stat-content">
                  <h5>Revenue</h5>
                  <h3 id="revenue">â‚¹0</h3>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-user-plus"></i>
                </div>
                <div class="stat-content">
                  <h5>New Enrollments</h5>
                  <h3 id="newEnrollments">0</h3>
                </div>
              </div>
            </div>
          </div>

          <!-- Dashboard Content -->
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Welcome to Admin Dashboard</h5>
                  <p class="card-text" id="dashboardMessage">
                    Manage your art academy efficiently from this dashboard. Monitor student enrollments, course statistics, and revenue all in one place.
                  </p>
                  <div class="mt-3">
                    <button class="btn btn-primary me-2">
                      <i class="fas fa-plus me-1"></i> Add New Course
                    </button>
                    <button class="btn btn-outline-secondary">
                      <i class="fas fa-download me-1"></i> Export Report
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="/js/admin_dashboard.js"></script>

  <script>
    // immediate protection
    (function() {
      const token = localStorage.getItem('token');
      const user = localStorage.getItem('user');

      if (!token || !user) {
        console.log('No credentials found, redirecting to login');
        window.location.href = 'login.html';
        return;
      }

      // Parse user to check role immediately
      try {
        const userData = JSON.parse(user);
        if (userData.role !== 'admin') {
          console.log('User is not admin, redirecting to login');
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = 'login.html';
          return;
        }
      } catch (error) {
        console.log('Error parsing user data, redirecting to login');
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = 'login.html';
        return;
      }

    })();
  </script>
</body>

</html>