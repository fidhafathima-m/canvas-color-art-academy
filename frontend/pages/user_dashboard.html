<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard - Canvas & Color Art Academy</title>

  <!-- Cache Control Meta Tags -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/styles/user_dashboard.css">
</head>

<body>
  <!-- Loading Overlay -->
  <div id="loadingOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; justify-content: center; align-items: center; z-index: 9999;">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Verifying authentication...</p>
    </div>
  </div>

  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" id="mobileMenuToggle">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Overlay for mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3 col-lg-2 sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="d-flex align-items-center">
            <i class="fas fa-palette me-2"></i>
            <span class="brand-text">Student Portal</span>
          </div>
        </div>
        <nav class="nav flex-column">
          <a class="nav-link active" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Dashboard">
            <i class="fas fa-tachometer-alt"></i>
            <span class="nav-text">Dashboard</span>
          </a>
          <a class="nav-link" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="My Courses">
            <i class="fas fa-book"></i>
            <span class="nav-text">My Courses</span>
          </a>
          <a class="nav-link" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Schedule">
            <i class="fas fa-calendar-alt"></i>
            <span class="nav-text">Schedule</span>
          </a>
          <a class="nav-link" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Progress">
            <i class="fas fa-chart-line"></i>
            <span class="nav-text">Progress</span>
          </a>
          <a class="nav-link" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Achievements">
            <i class="fas fa-award"></i>
            <span class="nav-text">Achievements</span>
          </a>
          <a class="nav-link" href="#" data-bs-toggle="tooltip" data-bs-placement="right" title="Profile">
            <i class="fas fa-user"></i>
            <span class="nav-text">Profile</span>
          </a>
          <a class="nav-link" href="#" id="logoutBtn" data-bs-toggle="tooltip" data-bs-placement="right" title="Logout">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-text">Logout</span>
          </a>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="col-md-9 col-lg-10 main-content" id="mainContent">
        <div class="content-wrapper">
          <!-- Header -->
          <div class="dashboard-header">
            <div class="header-content">
              <h2 class="mb-1">Student Dashboard</h2>
              <p class="text-muted mb-0" id="welcomeMessage">Welcome back!</p>
            </div>
            <div class="header-actions">
              <div class="position-relative me-3">
                <i class="fas fa-bell fa-lg text-muted"></i>
                <span class="notification-badge">3</span>
              </div>
              <div class="user-profile">
                <div class="avatar me-2" id="userAvatar">SU</div>
                <div class="user-info">
                  <strong id="userName">Student User</strong>
                  <div class="text-muted small" id="userRole">Student</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Welcome Card -->
          <div class="welcome-card">
            <div class="row align-items-center">
              <div class="col-lg-8 col-md-7">
                <h3 id="greetingMessage">Hello, Creative Mind!</h3>
                <p class="mb-0">Continue your artistic journey. You're doing amazing!</p>
              </div>
              <div class="col-lg-4 col-md-5 text-end">
                <i class="fas fa-paint-brush fa-4x opacity-75"></i>
              </div>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="row stats-row">
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-book-open"></i>
                </div>
                <div class="stat-content">
                  <h5>Enrolled Courses</h5>
                  <h3 id="enrolledCourses">3</h3>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                  <h5>Overall Progress</h5>
                  <h3 id="overallProgress">65%</h3>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-tasks"></i>
                </div>
                <div class="stat-content">
                  <h5>Assignments Due</h5>
                  <h3 id="assignmentsDue">2</h3>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-3">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-award"></i>
                </div>
                <div class="stat-content">
                  <h5>Certificates</h5>
                  <h3 id="certificatesEarned">1</h3>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="/js/user_dashboard.js"></script>

  <script>
    // immediate protection for student dashboard
    (function() {
      const token = localStorage.getItem('token');
      const user = localStorage.getItem('user');

      if (!token || !user) {
        console.log('No credentials found, redirecting to login');
        window.location.href = 'login.html';
        return;
      }

      // Parse user to check role immediately
      try {
        const userData = JSON.parse(user);

        // Allow both 'user' and 'student' roles for student dashboard
        if (userData.role !== 'user' && userData.role !== 'student') {
          console.log('User is not student, redirecting to login');
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = 'login.html';
          return;
        }
      } catch (error) {
        console.log('Error parsing user data, redirecting to login');
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = 'login.html';
        return;
      }

    })();
  </script>
</body>

</html>